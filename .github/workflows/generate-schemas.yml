name: Generate Schemas

on:
  workflow_run:
    workflows: ["Build Schema Generator"]
    types:
      - completed
  schedule:
    - cron: "0 */6 * * *"

jobs:
  download-driver:
    runs-on: ubuntu-latest
    steps:
      - uses: browser-actions/setup-chrome@latest
      - run: chrome --version

  run:
    needs: download-driver
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Download Schema Generator
        id: download-schema-gen
        uses: dawidd6/action-download-artifact@v2
        with:
          workflow: build.yml
          name: schema-gen
          path: artifacts/
      - name: Make it executable
        run: chmod +x artifacts/schema-gen
      - name: Refetch Schemas
        run: |
          ./artifacts/schema-gen refetch --metadata-url metadata.json
      - name: Generate Schemas
        run: |
          ./artifacts/schema-gen generate --metadata-url metadata.json
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}